<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Hub</title>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; font-family:Arial,sans-serif; color:white; }
    canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; background:black; }
    h1 { text-align:center; margin-top:20px; }
    #gameGrid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px; margin:20px; }
    .gameBox { background:rgba(255,255,255,0.1); padding:20px; border-radius:10px; text-align:center; font-weight:bold; cursor:pointer; transition:0.3s; color:white; opacity:0; transform:translateY(20px); animation:fadeIn 0.5s forwards; }
    @keyframes fadeIn { to { opacity:1; transform:translateY(0); } }
    .gameBox img { max-width:100%; max-height:100px; border-radius:6px; margin-bottom:10px; }
    .gameBox:hover { background: rgba(255,255,255,0.2); }
    #devPanel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.9); padding:20px; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.5); color:white; z-index:10; }
    #devPanel input, #devPanel button { margin:5px 0; padding:10px; width:100%; border-radius:10px; border:none; cursor:pointer; background:rgba(255,255,255,0.1); color:white; transition:0.2s; }
    #devPanel input:hover, #devPanel button:hover { background: rgba(255,255,255,0.2); }
    label { display:block; margin:5px 0 0; }

    /* ðŸŽµ Volume Control */
    #volumeControl {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(0,0,0,0.6);
      padding: 10px 15px;
      border-radius: 12px;
      border: 1px solid white;
      z-index: 20;
    }
    #volumeControl img {
      width: 30px;
      height: 30px;
      display: none;            /* toggled by JS */
      cursor: pointer;
      border: 2px solid #fff;   /* white outline */
      border-radius: 8px;
      box-shadow: 0 0 0 2px rgba(255,255,255,0.25) inset;
      background: rgba(255,255,255,0.05);
    }
    #volumeSlider {
      -webkit-appearance: none;
      appearance: none;
      width: 140px;
      height: 8px;
      border-radius: 4px;
      background: rgba(255,255,255,0.25);
      outline: none;
      cursor: pointer;
      position: relative;
    }
    #volumeSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #ffd54d;
      border: 2px solid black;
      cursor: pointer;
    }
    #volumeSlider::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #ffd54d;
      border: 2px solid black;
      cursor: pointer;
    }

    /* Value bubble above the thumb */
    .sliderWrap { position: relative; display: inline-block; }
    #volumeBubble {
      position:absolute;
      top:-32px;
      transform: translateX(-50%);
      min-width: 30px;
      padding:2px 6px;
      font-size:12px;
      text-align:center;
      background: rgba(0,0,0,0.7);
      border:1px solid #fff;
      border-radius:8px;
      pointer-events:none;
    }
  </style>
</head>
<body>
  <canvas id="galaxy"></canvas>
  <h1>Game Hub</h1>
  <div id="gameGrid"></div>

  <div id="devPanel">
    <h2>Add a New Game</h2>
    <input type="text" id="gameName" placeholder="Game Name">
    <label for="gameFile">Choose HTML File</label>
    <input type="file" id="gameFile" accept=".html">
    <label for="gameImage">Choose Image (optional)</label>
    <input type="file" id="gameImage" accept="image/*">
    <button onclick="addGame()">Add Game</button>
  </div>

  <!-- ðŸŽµ Volume Control -->
  <div id="volumeControl">
    <!-- Make sure these filenames exist next to index.html -->
    <img id="muteIcon" src="3573644.png" alt="Muted">
    <img id="unmuteIcon" src="35736442.png" alt="Unmuted">
    <div class="sliderWrap">
      <input type="range" id="volumeSlider" min="0" max="100" value="50">
      <span id="volumeBubble">50</span>
    </div>
  </div>

  <!-- ðŸŽ¶ Background Music -->
  <audio id="bgMusic" src="cherryside-reprise.mp3" loop autoplay></audio>

  <script type="module">
    /* ===== Firebase ===== */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCgWMRsEFRQsoyLNZkPJ-Pvw2ua_yMEW2A ",
      authDomain: "gamesite-92b3b.firebaseapp.com ",
      projectId: "gamesite-92b3b ",
      storageBucket: "gamesite-92b3b.firebasestorage.app ",
      messagingSenderId: "319292502868 ",
      appId: "1:319292502868:web:b2258aeb93fd32e118cec1 "
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const gamesCol = collection(db, "games");

    const grid = document.getElementById("gameGrid");
    const devPanel = document.getElementById("devPanel");

    let games = [];

    async function fetchGames() {
      const snapshot = await getDocs(gamesCol);
      games = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));
      renderGames();
    }

    function renderGames() {
      grid.innerHTML = "";
      games.forEach(game => {
        let box = document.createElement("div");
        box.className = "gameBox";

        if (game.image) {
          let img = document.createElement("img");
          img.src = game.image;
          box.appendChild(img);
        }

        let title = document.createElement("div");
        title.innerText = game.name;
        box.appendChild(title);

        box.onclick = () => {
          const newWindow = window.open();
          newWindow.document.write(game.html);
          newWindow.document.close();
        };

        if (devPanel.style.display === "block") {
          let delBtn = document.createElement("button");
          delBtn.innerText = "Delete";
          delBtn.onclick = async (e) => {
            e.stopPropagation();
            if (confirm('Delete this game?')) {
              await deleteDoc(doc(db, "games", game.id));
              fetchGames();
            }
          };
          box.appendChild(delBtn);
        }

        grid.appendChild(box);
      });
    }

    let keysPressed = new Set();
    document.addEventListener("keydown", e => {
      keysPressed.add(e.key.toLowerCase());
      if (keysPressed.has('d') && keysPressed.has('e') && keysPressed.has('v')) {
        devPanel.style.display = (devPanel.style.display === "block") ? "none" : "block";
        fetchGames();
      }
    });
    document.addEventListener("keyup", e => keysPressed.delete(e.key.toLowerCase()));

    async function addGame() {
      const name = document.getElementById("gameName").value.trim();
      const file = document.getElementById("gameFile").files[0];
      const imageFile = document.getElementById("gameImage").files[0];

      if (!name || !file) { alert('Provide name and file'); return; }

      const reader = new FileReader();
      reader.onload = async e => {
        let htmlContent = e.target.result;
        let imageData = "";

        if (imageFile) {
          const imgReader = new FileReader();
          imgReader.onload = async ev => {
            imageData = ev.target.result;
            await addDoc(gamesCol, { name, html: htmlContent, image: imageData });
            devPanel.style.display = "none";
            fetchGames();
          };
          imgReader.readAsDataURL(imageFile);
        } else {
          await addDoc(gamesCol, { name, html: htmlContent, image: "" });
          devPanel.style.display = "none";
          fetchGames();
        }
      };
      reader.readAsText(file);
    }

    fetchGames();

    /* ===== ðŸŽµ Volume Control Logic ===== */
    const bgMusic = document.getElementById("bgMusic");
    const volumeSlider = document.getElementById("volumeSlider");
    const volumeBubble = document.getElementById("volumeBubble");
    const muteIcon = document.getElementById("muteIcon");
    const unmuteIcon = document.getElementById("unmuteIcon");

    let lastVolume = 50; // remember last non-zero volume

    function setBubblePosition() {
      const sliderRect = volumeSlider.getBoundingClientRect();
      const min = parseInt(volumeSlider.min || "0");
      const max = parseInt(volumeSlider.max || "100");
      const val = parseInt(volumeSlider.value);
      const percent = (val - min) / (max - min);

      // Position the bubble over the thumb (approximate 22px thumb width)
      const thumb = 22;
      const x = percent * (volumeSlider.clientWidth - thumb) + (thumb / 2);
      volumeBubble.style.left = `${x}px`;
    }

    function updateVolumeUI() {
      const volume = parseInt(volumeSlider.value);
      volumeBubble.textContent = volume;
      bgMusic.volume = volume / 100;
      muteIcon.style.display = (volume === 0) ? "block" : "none";
      unmuteIcon.style.display = (volume > 0) ? "block" : "none";
      if (volume > 0) lastVolume = volume;
      setBubblePosition();
    }

    volumeSlider.addEventListener("input", updateVolumeUI);
    window.addEventListener("resize", setBubblePosition);

    // Click icons to toggle
    muteIcon.addEventListener("click", () => {
      volumeSlider.value = lastVolume;
      updateVolumeUI();
      try { bgMusic.play(); } catch(e) {}
    });

    unmuteIcon.addEventListener("click", () => {
      volumeSlider.value = 0;
      updateVolumeUI();
    });

    // Kick audio on first user interaction (helps with autoplay policies)
    document.addEventListener("click", () => {
      if (bgMusic.paused && parseInt(volumeSlider.value) > 0) {
        bgMusic.play().catch(()=>{});
      }
    }, { once: true });

    // Init UI
    updateVolumeUI();

    /* ===== ðŸŒŒ Galaxy animation code (unchanged) ===== */
    const canvas = document.getElementById("galaxy");
    const ctx = canvas.getContext("2d");
    let particles = [];
    let cursor = {x: window.innerWidth/2, y: window.innerHeight/2};
    function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();
    window.addEventListener('mousemove', e=>{ cursor.x=e.clientX; cursor.y=e.clientY; });
    class Particle { constructor(a,r){ this.angle=a; this.radius=r; this.size=Math.random()*2; this.speed=0.0005+Math.random()*0.0005; }
      draw(x,y){ ctx.fillStyle='white'; ctx.beginPath(); ctx.arc(x,y,this.size,0,Math.PI*2); ctx.fill(); }
      update(){ this.angle+=this.speed; let s=this.radius*0.15;
        let x=canvas.width/2+Math.cos(this.angle+this.radius/100)*this.radius+s*Math.cos(this.angle*2);
        let y=canvas.height/2+Math.sin(this.angle+this.radius/100)*this.radius*s*Math.sin(this.angle*2);
        let tiltX=(x-canvas.width/2)*1.2; let tiltY=(y-canvas.height/2)*0.6;
        let dx=cursor.x-(canvas.width/2+tiltX); let dy=cursor.y-(canvas.height/2+tiltY);
        let dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<80){ tiltX-=dx*0.05; tiltY-=dy*0.05; }
        this.draw(canvas.width/2+tiltX, canvas.height/2+tiltY);
      }
    }
    function initParticles(){ particles=[]; for(let i=0;i<2000;i++){ particles.push(new Particle(Math.random()*Math.PI*2,Math.random()*canvas.width/2)); }}
    initParticles();
    function animate(){ ctx.fillStyle='rgba(0,0,0,0.2)'; ctx.fillRect(0,0,canvas.width,canvas.height);
      let grad=ctx.createRadialGradient(canvas.width/2,canvas.height/2,0,canvas.width/2,canvas.height/2,200);
      grad.addColorStop(0,'rgba(255,255,200,0.6)'); grad.addColorStop(1,'rgba(0,0,0,0)'); ctx.fillStyle=grad; ctx.fillRect(0,0,canvas.width,canvas.height);
      particles.forEach(p=>p.update()); requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>
