<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galactical Games</title>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; font-family:Arial,sans-serif; color:white; }
    canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; background:black; }
    #titleContainer { text-align:center; margin-top:10px; position:relative; z-index:1; }
    #titleContainer img { width:400px; max-width:80%; }
    #audioControls { text-align:center; margin:10px; position:relative; z-index:1; }
    #gameGrid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px; margin:20px; position:relative; z-index:1; }
    .gameBox { background:rgba(255,255,255,0.1); padding:20px; border-radius:10px; text-align:center; font-weight:bold; cursor:pointer; transition:0.3s; color:white; opacity:0; transform:translateY(20px); animation:fadeIn 0.5s forwards; }
    @keyframes fadeIn { to { opacity:1; transform:translateY(0); } }
    .gameBox img { max-width:100%; max-height:100px; border-radius:6px; margin-bottom:10px; }
    .gameBox:hover { background: rgba(255,255,255,0.2); }
    #devPanel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.9); padding:20px; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.5); color:white; z-index:10; }
    #devPanel input, #devPanel button { margin:5px 0; padding:10px; width:100%; border-radius:10px; border:none; cursor:pointer; background:rgba(255,255,255,0.1); color:white; transition:0.2s; }
    #devPanel input:hover, #devPanel button:hover { background: rgba(255,255,255,0.2); }
    label { display:block; margin:5px 0 0; }
  </style>
</head>
<body>
  <canvas id="galaxy"></canvas>
  
  <div id="titleContainer">
    <img src="unnamed.png" alt="Galactical Games">
  </div>

  <div id="audioControls">
    <button id="musicToggle">Play Music</button>
    <label for="volumeSlider">Volume</label>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
  </div>

  <div id="gameGrid"></div>

  <div id="devPanel">
    <h2>Add a New Game</h2>
    <input type="text" id="gameName" placeholder="Game Name">
    <label for="gameFile">Choose HTML File</label>
    <input type="file" id="gameFile" accept=".html">
    <label for="gameImage">Choose Image (optional)</label>
    <input type="file" id="gameImage" accept="image/*">
    <button onclick="addGame()">Add Game</button>
  </div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCgWMRsEFRQsoyLNZkPJ-Pvw2ua_yMEW2A",
  authDomain: "gamesite-92b3b.firebaseapp.com",
  projectId: "gamesite-92b3b",
  storageBucket: "gamesite-92b3b.firebasestorage.app",
  messagingSenderId: "319292502868",
  appId: "1:319292502868:web:b2258aeb93fd32e118cec1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const gamesCol = collection(db, "games");

const grid = document.getElementById("gameGrid");
const devPanel = document.getElementById("devPanel");

let games = [];

async function fetchGames() {
  const snapshot = await getDocs(gamesCol);
  games = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));
  renderGames();
}

function renderGames() {
  grid.innerHTML = "";
  games.forEach(game => {
    let box = document.createElement("div");
    box.className = "gameBox";

    if(game.image){
      let img = document.createElement("img");
      img.src = game.image;
      box.appendChild(img);
    }

    let title = document.createElement("div");
    title.innerText = game.name;
    box.appendChild(title);

    box.onclick = () => {
      const newWindow = window.open();
      newWindow.document.write(game.html);
      newWindow.document.close();
    };

    if(devPanel.style.display === "block"){
      let delBtn = document.createElement("button");
      delBtn.innerText = "Delete";
      delBtn.onclick = async (e) => {
        e.stopPropagation();
        if(confirm('Delete this game?')){
          await deleteDoc(doc(db, "games", game.id));
          fetchGames();
        }
      };
      box.appendChild(delBtn);
    }

    grid.appendChild(box);
  });
}

// Developer panel toggle
let keysPressed = new Set();
document.addEventListener("keydown", e => {
  keysPressed.add(e.key.toLowerCase());
  if(keysPressed.has('d') && keysPressed.has('e') && keysPressed.has('v')){
    devPanel.style.display = (devPanel.style.display === "block") ? "none" : "block";
    fetchGames();
  }
});
document.addEventListener("keyup", e => keysPressed.delete(e.key.toLowerCase()));

// Add game
async function addGame(){
  const name = document.getElementById("gameName").value.trim();
  const file = document.getElementById("gameFile").files[0];
  const imageFile = document.getElementById("gameImage").files[0];

  if(!name || !file){ alert('Provide name and file'); return; }

  const reader = new FileReader();
  reader.onload = async e => {
    let htmlContent = e.target.result;
    let imageData = "";

    if(imageFile){
      const imgReader = new FileReader();
      imgReader.onload = async ev => {
        imageData = ev.target.result;
        await addDoc(gamesCol, { name, html: htmlContent, image: imageData });
        devPanel.style.display = "none";
        fetchGames();
      };
      imgReader.readAsDataURL(imageFile);
    } else {
      await addDoc(gamesCol, { name, html: htmlContent, image: "" });
      devPanel.style.display = "none";
      fetchGames();
    }
  };
  reader.readAsText(file);
}

fetchGames();
  <!-- Music Controls -->
  <div id="musicControls">
    <button id="playPauseBtn">Play</button>
    <label for="volume">Volume:</label>
    <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
  </div>

  <!-- Audio -->
  <audio id="bgMusic" loop>
    <source src="cherryside-reprise.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <script>
    const audio = document.getElementById("bgMusic");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const volumeControl = document.getElementById("volume");

    playPauseBtn.addEventListener("click", () => {
      if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = "Pause";
      } else {
        audio.pause();
        playPauseBtn.textContent = "Play";
      }
    });

    volumeControl.addEventListener("input", () => {
      audio.volume = volumeControl.value;
    });
  </script>
</body>
</html>
