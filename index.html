<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Hub</title>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; font-family:Arial,sans-serif; color:white; }
    canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; background:black; }
    h1 { text-align:center; margin-top:20px; }
    #gameGrid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px; margin:20px; }
    .gameBox { background:rgba(255,255,255,0.1); padding:20px; border-radius:10px; text-align:center; font-weight:bold; cursor:pointer; transition:0.3s; color:white; opacity:0; transform:translateY(20px); animation:fadeIn 0.5s forwards; }
    @keyframes fadeIn { to { opacity:1; transform:translateY(0); } }
    .gameBox img { max-width:100%; max-height:100px; border-radius:6px; margin-bottom:10px; background:white; } /* solid white bg behind images */
    .gameBox:hover { background: rgba(255,255,255,0.2); }
    #devPanel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.9); padding:20px; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.5); color:white; z-index:10; }
    #devPanel input, #devPanel button { margin:5px 0; padding:10px; width:100%; border-radius:10px; border:none; cursor:pointer; background:rgba(255,255,255,0.1); color:white; transition:0.2s; }
    #devPanel input:hover, #devPanel button:hover { background: rgba(255,255,255,0.2); }
    label { display:block; margin:5px 0 0; }

    /* ðŸŽµ Volume Control */
    #volumeControl {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(0,0,0,0.6);
      padding: 10px 15px;
      border-radius: 12px;
      border: 1px solid white;
      z-index: 20;
    }
    #volumeControl img {
      width: 30px;
      height: 30px;
      display: none;            /* toggled by JS */
      cursor: pointer;
      border: 2px solid #fff;   /* white outline */
      border-radius: 8px;
      box-shadow: 0 0 4px rgba(0,0,0,0.5);
      background: white;        /* âœ… solid white background */
    }
    #volumeSlider {
      -webkit-appearance: none;
      appearance: none;
      width: 140px;
      height: 8px;
      border-radius: 4px;
      background: rgba(255,255,255,0.25);
      outline: none;
      cursor: pointer;
      position: relative;
    }
    #volumeSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #ffd54d;
      border: 2px solid black;
      cursor: pointer;
    }
    #volumeSlider::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #ffd54d;
      border: 2px solid black;
      cursor: pointer;
    }

    /* Value bubble above the thumb */
    .sliderWrap { position: relative; display: inline-block; }
    #volumeBubble {
      position:absolute;
      top:-32px;
      transform: translateX(-50%);
      min-width: 30px;
      padding:2px 6px;
      font-size:12px;
      text-align:center;
      background: rgba(0,0,0,0.7);
      border:1px solid #fff;
      border-radius:8px;
      pointer-events:none;
    }

    /* ðŸŒŒ Cursor bubble glow (always visible, pulsing) */
    #cursorGlow {
      position: fixed;
      pointer-events: none;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0) 70%);
      width: 400px;
      height: 400px;
      margin-left: -200px;
      margin-top: -200px;
      z-index: -1; /* above canvas (same z, later in DOM), below UI */
      animation: pulseGlow 3s ease-in-out infinite;
    }
    @keyframes pulseGlow {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
  </style>
</head>
<body>
  <canvas id="galaxy"></canvas>
  <div id="cursorGlow"></div> <!-- glow sits above canvas -->

  <h1>Game Hub</h1>
  <div id="gameGrid"></div>

  <div id="devPanel">
    <h2>Add a New Game</h2>
    <input type="text" id="gameName" placeholder="Game Name">
    <label for="gameFile">Choose HTML File</label>
    <input type="file" id="gameFile" accept=".html">
    <label for="gameImage">Choose Image (optional)</label>
    <input type="file" id="gameImage" accept="image/*">
    <button onclick="addGame()">Add Game</button>
  </div>

  <!-- ðŸŽµ Volume Control -->
  <div id="volumeControl">
    <img id="muteIcon" src="3573644.png" alt="Muted">
    <img id="unmuteIcon" src="35736442.png" alt="Unmuted">
    <div class="sliderWrap">
      <input type="range" id="volumeSlider" min="0" max="100" value="50">
      <span id="volumeBubble">50</span>
    </div>
  </div>

  <!-- ðŸŽ¶ Background Music -->
  <audio id="bgMusic" src="cherryside-reprise.mp3" loop autoplay></audio>

  <script type="module">
    /* ===== Firebase ===== */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCgWMRsEFRQsoyLNZkPJ-Pvw2ua_yMEW2A ",
      authDomain: "gamesite-92b3b.firebaseapp.com ",
      projectId: "gamesite-92b3b ",
      storageBucket: "gamesite-92b3b.firebasestorage.app ",
      messagingSenderId: "319292502868 ",
      appId: "1:319292502868:web:b2258aeb93fd32e118cec1 "
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const gamesCol = collection(db, "games");

    const grid = document.getElementById("gameGrid");
    const devPanel = document.getElementById("devPanel");

    let games = [];

    async function fetchGames() {
      const snapshot = await getDocs(gamesCol);
      games = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));
      renderGames();
    }

    function renderGames() {
      grid.innerHTML = "";
      games.forEach(game => {
        let box = document.createElement("div");
        box.className = "gameBox";

        if (game.image) {
          let img = document.createElement("img");
          img.src = game.image;
          box.appendChild(img);
        }

        let title = document.createElement("div");
        title.innerText = game.name;
        box.appendChild(title);

        box.onclick = () => {
          const newWindow = window.open();
          newWindow.document.write(game.html);
          newWindow.document.close();
        };

        if (devPanel.style.display === "block") {
          let delBtn = document.createElement("button");
          delBtn.innerText = "Delete";
          delBtn.onclick = async (e) => {
            e.stopPropagation();
            if (confirm('Delete this game?')) {
              await deleteDoc(doc(db, "games", game.id));
              fetchGames();
            }
          };
          box.appendChild(delBtn);
        }

        grid.appendChild(box);
      });
    }

    let keysPressed = new Set();
    document.addEventListener("keydown", e => {
      keysPressed.add(e.key.toLowerCase());
      if (keysPressed.has('d') && keysPressed.has('e') && keysPressed.has('v')) {
        devPanel.style.display = (devPanel.style.display === "block") ? "none" : "block";
        fetchGames();
      }
    });
    document.addEventListener("keyup", e => keysPressed.delete(e.key.toLowerCase()));

    async function addGame() {
      const name = document.getElementById("gameName").value.trim();
      const file = document.getElementById("gameFile").files[0];
      const imageFile = document.getElementById("gameImage").files[0];

      if (!name || !file) { alert('Provide name and file'); return; }

      const reader = new FileReader();
      reader.onload = async e => {
        let htmlContent = e.target.result;
        let imageData = "";

        if (imageFile) {
          const imgReader = new FileReader();
          imgReader.onload = async ev => {
            imageData = ev.target.result;
            await addDoc(gamesCol, { name, html: htmlContent, image: imageData });
            devPanel.style.display = "none";
            fetchGames();
          };
          imgReader.readAsDataURL(imageFile);
        } else {
          await addDoc(gamesCol, { name, html: htmlContent, image: "" });
          devPanel.style.display = "none";
          fetchGames();
        }
      };
      reader.readAsText(file);
    }

    fetchGames();

    /* ===== ðŸŽµ Volume Control Logic ===== */
    const bgMusic = document.getElementById("bgMusic");
    const volumeSlider = document.getElementById("volumeSlider");
    const volumeBubble = document.getElementById("volumeBubble");
    const muteIcon = document.getElementById("muteIcon");
    const unmuteIcon = document.getElementById("unmuteIcon");

    let lastVolume = 50; // remember last non-zero volume

    function setBubblePosition() {
      const min = parseInt(volumeSlider.min || "0");
      const max = parseInt(volumeSlider.max || "100");
      const val = parseInt(volumeSlider.value);
      const percent = (val - min) / (max - min);

      // Position the bubble over the thumb (approximate 22px thumb width)
      const thumb = 22;
      const x = percent * (volumeSlider.clientWidth - thumb) + (thumb / 2);
      volumeBubble.style.left = `${x}px`;
    }

    function updateVolumeUI() {
      const volume = parseInt(volumeSlider.value);
      volumeBubble.textContent = volume;
      bgMusic.volume = volume / 100;
      muteIcon.style.display = (volume === 0) ? "block" : "none";
      unmuteIcon.style.display = (volume > 0) ? "block" : "none";
      if (volume > 0) lastVolume = volume;
      setBubblePosition();
    }

    volumeSlider.addEventListener("input", updateVolumeUI);
    window.addEventListener("resize", setBubblePosition);

    // Click icons to toggle
    muteIcon.addEventListener("click", () => {
      volumeSlider.value = lastVolume;
      updateVolumeUI();
      try { bgMusic.play(); } catch(e) {}
    });

    unmuteIcon.addEventListener("click", () => {
      volumeSlider.value = 0;
      updateVolumeUI();
    });

    // Kick audio on first user interaction (helps with autoplay policies)
    document.addEventListener("click", () => {
      if (bgMusic.paused && parseInt(volumeSlider.value) > 0) {
        bgMusic.play().catch(()=>{});
      }
    }, { once: true });

    // Init UI
    updateVolumeUI();

    /* ===== ðŸŒŒ Galaxy animation (fixed + colored + stronger bubble) ===== */
    const canvas = document.getElementById("galaxy");
    const ctx = canvas.getContext("2d");
    const cursorGlow = document.getElementById("cursorGlow");

    let particles = [];
    let cursor = {x: window.innerWidth/2, y: window.innerHeight/2};

    function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();

    // track cursor + glow position
    window.addEventListener('mousemove', e=>{
      cursor.x=e.clientX; cursor.y=e.clientY;
      cursorGlow.style.left = `${e.clientX}px`;
      cursorGlow.style.top  = `${e.clientY}px`;
    });

    const starColors = ["#ffffff", "#ffe9c4", "#d4fbff", "#ffd1dc", "#b5c7ff"];

    // Bubble constants (stronger magnifier + pull)
    const BUBBLE_RADIUS = 220;
    const BUBBLE_PULL   = 0.18;  // stronger than before
    const MAGNIFY       = 1.8;   // visual size boost near cursor

    class Particle {
      constructor(a,r){
        this.angle=a;
        this.radius=r;
        this.baseSize = Math.random()*2;
        this.size = this.baseSize;
        this.speed=0.0005+Math.random()*0.001;
        this.color = starColors[Math.floor(Math.random()*starColors.length)];
      }
      draw(x,y,s){
        ctx.fillStyle=this.color;
        ctx.beginPath();
        ctx.arc(x,y,s,0,Math.PI*2);
        ctx.fill();
      }
      update(){
        this.angle += this.speed;

        // Smooth orbiting position (ellipse)
        const x0 = canvas.width/2  + Math.cos(this.angle) * this.radius;
        const y0 = canvas.height/2 + Math.sin(this.angle) * this.radius;

        // Galaxy tilt
        let tiltX=(x0-canvas.width/2)*1.2;
        let tiltY=(y0-canvas.height/2)*0.6;

        // Cursor force
        const worldX = canvas.width/2 + tiltX;
        const worldY = canvas.height/2 + tiltY;
        let dx = cursor.x - worldX;
        let dy = cursor.y - worldY;
        let dist = Math.hypot(dx,dy);

        let sizeToDraw = this.baseSize;

        if (dist < BUBBLE_RADIUS){
          const force = 1 - (dist / BUBBLE_RADIUS); // 0..1
          tiltX -= dx * BUBBLE_PULL * force;
          tiltY -= dy * BUBBLE_PULL * force;

          // magnify the star visually near the cursor
          sizeToDraw = this.baseSize * (1 + force * (MAGNIFY - 1));
        }

        this.draw(canvas.width/2 + tiltX, canvas.height/2 + tiltY, sizeToDraw);
      }
    }

    function initParticles(){
      particles=[];
      const maxR = Math.max(canvas.width, canvas.height) / 2;
      for(let i=0;i<1500;i++){
        particles.push(new Particle(Math.random()*Math.PI*2, Math.random()*maxR));
      }
    }
    initParticles();

    function animate(){
      // trails
      ctx.fillStyle='rgba(0,0,0,0.2)';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // galaxy core glow
      const grad=ctx.createRadialGradient(canvas.width/2,canvas.height/2,0,canvas.width/2,canvas.height/2,320);
      grad.addColorStop(0,'rgba(255,255,200,0.5)');
      grad.addColorStop(1,'rgba(0,0,0,0)');
      ctx.fillStyle=grad;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      particles.forEach(p=>p.update());
      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>
